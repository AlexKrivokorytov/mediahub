use tauri::State;
use serde::{Deserialize, Serialize};
use crate::services::database::{Database, UserCredentials};
use anyhow::Result;

#[derive(Serialize, Deserialize)]
pub struct SpotifyAuthRequest {
    pub client_id: String,
    pub client_secret: String,
    pub redirect_uri: String,
}

#[tauri::command]
pub fn spotify_authenticate(
    request: SpotifyAuthRequest,
    db: State<'_, Database>
) -> Result<String, String> {
    let creds = UserCredentials {
        service: "spotify".into(),
        access_token: request.client_id,
        refresh_token: Some(request.client_secret),
        expires_at: None,
    };
    db.save_credentials(creds).map_err(|e| e.to_string())?;
    Ok("Spotify connected".into())
}

#[tauri::command]
pub fn spotify_get_playlists() -> Result<Vec<String>, String> {
    // Р—Р°РіР»СѓС€РєР° вЂ” РїРѕР·Р¶Рµ РјРѕР¶РЅРѕ Р±СѓРґРµС‚ РІРµСЂРЅСѓС‚СЊ СЂРµР°Р»СЊРЅС‹Рµ РїР»РµР№Р»РёСЃС‚С‹
    Ok(vec![
        "Liked Songs".to_string(),
        "Workout Mix".to_string(),
        "Anime OSTs".to_string(),
    ])
}

#[tauri::command]
pub fn spotify_get_tracks() -> Result<Vec<String>, String> {
    // Р—Р°РіР»СѓС€РєР° вЂ” РїРѕР·Р¶Рµ РјРѕР¶РЅРѕ Р±СѓРґРµС‚ РїРѕРґРіСЂСѓР¶Р°С‚СЊ С‚СЂРµРєРё РёР· Spotify API
    Ok(vec![
        "Track 1 - Example".to_string(),
        "Track 2 - Example".to_string(),
    ])
}

